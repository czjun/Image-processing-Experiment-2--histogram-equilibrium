# 实验二、（双子）直方图均衡

## 一、实验目的
1. 掌握经典直方图均衡（HE）的基本原理及实现方法。
2. 理解HE的优缺点，分析其在亮度保持上的局限性。
3. 学习亮度保持双子直方图均衡（BBHE）的改进原理，实现并验证其亮度保持能力。
4. 对比HE与BBHE的效果，探讨改进算法的实际应用价值。

---

## 二、实验原理
### 1. 经典直方图均衡（HE）
**核心思想**：将图像直方图变换为近似均匀分布，扩展动态范围。  
**数学公式**：  
- 概率密度函数：  
$$ p(r_k) = \frac{n_k}{MN} $$  
  其中$n_k$是灰度级$r_k$的像素数，$M \times N$为图像尺寸。
- 累积分布函数（CDF）：  
$$ C(r_k) = \sum_{j=0}^{k} p(r_j) $$
- 映射函数：  
$$ s_k = T(r_k) = r_0 + (r_{L-1} - r_0) \cdot C(r_k) $$  
其中 \( r_0 = 0 \), \( r_{L-1} = L-1 \)（\( L \) 为灰度级总数）。
### 2. 亮度保持双子直方图均衡（BBHE）
**改进思路**：  
- 以图像均值为阈值，将图像分割为两个子图像$X_L$和$X_U$。
- 对子图像分别进行直方图均衡，映射范围约束为$[0, \mu]$和$[\mu, L-1]$。

**亮度保持验证**：  
- 输出均值：  
$$ \mu_{out} = \frac{\mu_L + \mu_U}{2} $$  
  其中$\mu$为中间灰度，相比HE更接近原图均值。

---

## 三、实验内容
1. **实现经典直方图均衡（HE）**：
   - 读取图像并灰度化；
   - 计算直方图及CDF，生成映射表；
   - 输出均衡化后的图像及直方图。

2. **实现亮度保持双子直方图均衡（BBHE）**：
   - 计算图像均值，分割直方图为左右两部分；
   - 分别对左右子图进行均衡化，约束映射范围；
   - 合并子图，输出结果及直方图。

3. **对比分析**：
   - 观察HE与BBHE的亮度变化及直方图分布；
   - 计算输出图像均值，验证BBHE的亮度保持精度。

---

## 四、实验步骤
### 1. 实验环境
- **软件**：Matlab或Python（需要安装OpenCV、Numpy、Matplotlib库）
- **测试图像**：低对比度图像（如灰度图“couple.jpg”）

### 2. 实验流程
1. 图像读取与预处理：彩色图像转为灰度图像
2. 经典直方图均衡：img_he = histeq(img_gray);
3. BBHE算法实现
4. 结果可视化：figure; imshowpair(img_gray, img_he, 'montage'); title('原图 vs HE');

---

## 五、实验要求
- **编程实现**：独立完成HE和BBHE代码编写
- **结果分析**：
1. 提交处理前后的图像及直方图对比图；
2. 计算HE和BBHE输出图像的均值，与原图均值对比，分析亮度保持精度.
- **实验报告**
1. 包含实验目的、原理、步骤、结果分析及思考题解答
2. 代码需附详细注释
---
## 六、思考题
1. HE为何会导致图像整体亮度偏移？BBHE如何解决这一问题？
2. 若输入图像的直方图分布极度不均匀（如大部分像素集中在某一段），BBHE是否仍能有效保持亮度？
3. 尝试提出一种改进BBHE的方法，使其在复杂光照场景下表现更优。